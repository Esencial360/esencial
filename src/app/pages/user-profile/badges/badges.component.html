<!-- 
  <div class="badges-header mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-bold text-gray-800">Mis Insignias</h2>
        <p class="text-gray-600 mt-1">
          Has desbloqueado {{ userBadges.length }} de {{ allBadges.length }} insignias
        </p>
      </div>
      <button 
        (click)="toggleBadgeView()"
        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
        {{ showAllBadges ? 'Mis Insignias' : 'Ver Todas' }}
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-4 border-purple-600 border-t-transparent"></div>
  </div>

  <div *ngIf="!loading && badgeProgress" class="progress-section mb-8 grid md:grid-cols-2 gap-4">
    <div class="progress-card bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl p-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold text-gray-800">Progreso de Racha</h3>
        <span class="text-2xl">ğŸ”¥</span>
      </div>
      <div class="mb-2">
        <div class="flex justify-between text-sm text-gray-600 mb-1">
          <span>{{ badgeProgress.streakProgress.current }} dÃ­as</span>
          <span>{{ badgeProgress.streakProgress.nextMilestone }} dÃ­as</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div 
            class="bg-gradient-to-r from-orange-400 to-yellow-400 h-full rounded-full transition-all duration-500"
            [style.width.%]="getProgressPercentage(badgeProgress.streakProgress.current, badgeProgress.streakProgress.nextMilestone)">
          </div>
        </div>
      </div>
      <p class="text-sm text-gray-600">
        PrÃ³xima insignia: <strong>{{ badgeProgress.streakProgress.nextBadgeName }}</strong>
      </p>
    </div>
    <div class="progress-card bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-semibold text-gray-800">Tiempo como Miembro</h3>
        <span class="text-2xl">ğŸ“…</span>
      </div>
      <div class="mb-2">
        <div class="flex justify-between text-sm text-gray-600 mb-1">
          <span>{{ badgeProgress.tenureProgress.daysActive }} dÃ­as</span>
          <span>{{ badgeProgress.tenureProgress.nextMilestone }} dÃ­as</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
          <div 
            class="bg-gradient-to-r from-blue-400 to-purple-400 h-full rounded-full transition-all duration-500"
            [style.width.%]="getProgressPercentage(badgeProgress.tenureProgress.daysActive, badgeProgress.tenureProgress.nextMilestone)">
          </div>
        </div>
      </div>
      <p class="text-sm text-gray-600">
        PrÃ³xima insignia: <strong>{{ badgeProgress.tenureProgress.nextBadgeName }}</strong>
      </p>
    </div>
  </div>

  <div *ngIf="!loading" class="badges-grid">
    <div *ngIf="!showAllBadges && userBadges.length > 0" class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div 
        *ngFor="let badge of userBadges" 
        (click)="selectBadge(badge)"
        class="badge-card cursor-pointer transform hover:scale-105 transition-transform">
        <div class="bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl p-4 text-center relative overflow-hidden">
          <div class="absolute top-0 right-0 -mt-1 -mr-1">
            <span class="text-2xl">âœ¨</span>
          </div>
          <div class="badge-icon w-20 h-20 mx-auto mb-2 flex items-center justify-center">
            <img 
              *ngIf="badge.icon" 
              [src]="badge.icon" 
              [alt]="badge.name"
              class="w-full h-full object-contain"
              onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <span style="display:none" class="text-4xl">ğŸ†</span>
          </div>
          <h4 class="font-semibold text-gray-800 text-sm">{{ badge.name }}</h4>
          <p class="text-xs text-gray-600 mt-1">{{ formatDate(badge.earnedOn) }}</p>
        </div>
      </div>
    </div>

    <div *ngIf="!showAllBadges && userBadges.length === 0" class="text-center py-12">
      <span class="text-6xl mb-4 block">ğŸ¯</span>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">Â¡Comienza tu ColecciÃ³n!</h3>
      <p class="text-gray-600">ContinÃºa practicando para desbloquear tu primera insignia</p>
    </div>
    <div *ngIf="showAllBadges" class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div 
        *ngFor="let badge of allBadges" 
        (click)="selectBadge(badge)"
        class="badge-card cursor-pointer transform hover:scale-105 transition-transform">
        <div 
          [ngClass]="{
            'bg-gradient-to-br from-purple-100 to-purple-200': hasBadge(badge.badgeId),
            'bg-gray-100 opacity-60': !hasBadge(badge.badgeId)
          }"
          class="rounded-xl p-4 text-center relative overflow-hidden">
   
          <div *ngIf="hasBadge(badge.badgeId)" class="absolute top-0 right-0 -mt-1 -mr-1">
            <span class="text-2xl">âœ¨</span>
          </div>
  
          <div *ngIf="!hasBadge(badge.badgeId)" class="absolute top-2 right-2">
            <span class="text-gray-400">ğŸ”’</span>
          </div>
          
          <div class="badge-icon w-20 h-20 mx-auto mb-2 flex items-center justify-center">
            <img 
              *ngIf="badge.icon" 
              [src]="badge.icon" 
              [alt]="badge.name"
              class="w-full h-full object-contain"
              [ngClass]="{'grayscale': !hasBadge(badge.badgeId)}"
              onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <span style="display:none" class="text-4xl">{{ hasBadge(badge.badgeId) ? 'ğŸ†' : 'â“' }}</span>
          </div>
          <h4 class="font-semibold text-gray-800 text-sm">{{ badge.name }}</h4>
          <p class="text-xs text-gray-600 mt-1">
            <span *ngIf="hasBadge(badge.badgeId)">{{ formatDate(getBadgeDate(badge.badgeId)) }}</span>
            <span *ngIf="!hasBadge(badge.badgeId)">No desbloqueada</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div 
    *ngIf="selectedBadge" 
    (click)="closeBadgeDetails()"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div 
      (click)="$event.stopPropagation()"
      class="bg-white rounded-2xl p-6 max-w-md w-full transform scale-100 animate-fadeIn">
      <div class="text-center">
        <div class="w-32 h-32 mx-auto mb-4 flex items-center justify-center">
          <img 
            *ngIf="selectedBadge.icon" 
            [src]="selectedBadge.icon" 
            [alt]="selectedBadge.name"
            class="w-full h-full object-contain"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <span style="display:none" class="text-6xl">ğŸ†</span>
        </div>
        <h3 class="text-2xl font-bold text-gray-800 mb-2">{{ selectedBadge.name }}</h3>
        
        <div *ngIf="hasBadge(selectedBadge.badgeId)" class="mb-4">
          <p class="text-green-600 font-semibold mb-2">âœ… Insignia Desbloqueada</p>
          <p class="text-gray-600">Obtenida el {{ formatDate(getBadgeDate(selectedBadge.badgeId)) }}</p>
        </div>
        
        <div *ngIf="!hasBadge(selectedBadge.badgeId)" class="mb-4">
          <p class="text-gray-500 font-semibold mb-2">ğŸ”’ AÃºn no desbloqueada</p>
        </div>
        
        <p class="text-gray-600 mb-4">{{ selectedBadge.description }}</p>
        
        <div class="bg-gray-100 rounded-lg p-3 mb-4">
          <p class="text-sm text-gray-700">
            <strong>Requisito:</strong> 
            <span *ngIf="selectedBadge.type === 'streak'">
              MantÃ©n una racha de {{ selectedBadge.requirement }} dÃ­as
            </span>
            <span *ngIf="selectedBadge.type === 'tenure'">
              SÃ© miembro activo durante {{ selectedBadge.requirement }} dÃ­as
            </span>
          </p>
        </div>
        
        <button 
          (click)="closeBadgeDetails()"
          class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div> -->