<div
  class="top-0 z-[60] w-full"
  [ngClass]="newLanding ? 'absolute' : 'relative'"
>
  @if(authService.isAuthenticated$ | async) {

  <!-- Authenticated Header -->
  <header
    [class]="getAuthenticatedHeaderClasses()"
    [style]="getHeaderBoxShadow()"
    class="relative overflow-hidden backdrop-blur-md bg-white/95 border-b border-white/20"
    [ngClass]="newLanding ? '!bg-transparent' : ''"
  >
    <!-- Desktop Header -->
    <div class="hidden xl:flex justify-between items-center px-20 h-20 relative z-10">
      <!-- Enhanced Logo -->
      <div class="flex items-center gap-3 cursor-pointer group" (click)="onHome()">
        <div class="relative">
          <img
            [src]="pullZone + '/assets/blueLogo.png'"
            alt="Logo"
            class="h-14 w-auto transition-all duration-300 group-hover:scale-105"
          />
          <!-- Glow effect -->
          <div class="absolute inset-0 bg-blue/20 rounded-xl opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-300 -z-10"></div>
        </div>
        <h3 class="font-bold text-2xl tracking-tight bg-gradient-to-r from-veige via-strongBrown to-blue bg-clip-text text-transparent group-hover:scale-105 transition-transform duration-300">
          esencial<span class="text-blue">360</span>
        </h3>
      </div>

      <!-- Enhanced Navigation -->
      <nav class="relative">
        <ul class="flex items-center space-x-8 font-medium uppercase text-sm tracking-wide">
          @if (roles === "User") {
          <!-- Enhanced Streak Display -->
          <div class="flex items-center pr-6 border-r border-gradient-to-b from-gray-300/30 to-gray-300/60">
            <div class="relative">
              <span class="text-2xl animate-pulse">ðŸ”¥</span>
              <div class="absolute -inset-1 bg-orange/20 rounded-full blur animate-pulse"></div>
            </div>
            <div class="ml-3 bg-gradient-to-r from-orange text-center to-red bg-clip-text text-transparent">
              <span class="font-bold text-xl">{{ streak }}</span>
              <div class="text-xs font-medium text-gray-600">dÃ­as</div>
            </div>
          </div>

          <!-- Enhanced Links -->
          <li>
            <a
              (click)="onInstructors()"
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Instructores
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          <li>
            <a 
              (click)="onClasses()" 
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Clases
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          <li>
            <a
              (click)="onMeditations()"
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Meditaciones
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          @if (newLanding) {
          <li>
            <a 
              (click)="onCounsel()" 
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Consejo
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          } }

          <!-- Enhanced Logout -->
          <li
            (click)="signOut()"
            class="relative group cursor-pointer hover:text-red-500 transition-all duration-300"
          >
            Logout
            <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-red-500 to-red-600 group-hover:w-full transition-all duration-300"></div>
          </li>

          <!-- Enhanced Profile Button -->
          @if (roles === "User") {
          <button
            (click)="onUserSettings()"
            class="group relative overflow-hidden flex items-center rounded-full bg-gradient-to-r from-lightBrown to-strongBrown px-6 py-3 text-white text-sm font-semibold uppercase shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
          >
            <!-- Button glow effect -->
            <div class="absolute inset-0 bg-gradient-to-r from-strongBrown to-blue opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full"></div>
            
            <span class="relative">Mi perfil</span>
            <svg
              class="relative w-4 h-4 ml-2 text-white group-hover:translate-x-1 transition-transform duration-300"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </button>
          }
        </ul>
      </nav>
    </div>

    <!-- Enhanced Mobile Header -->
    <div class="xl:hidden flex justify-between items-center px-4 h-16 relative z-10">
      <div class="flex items-center gap-3 cursor-pointer group" (click)="onHome()">
        <img
          [src]="pullZone + '/assets/blueLogo.png'"
          alt="Logo"
          class="h-12 w-auto rounded-xl shadow-md group-hover:shadow-lg transition-shadow duration-300"
        />
        <h3 class="font-bold text-lg bg-gradient-to-r from-veige to-strongBrown bg-clip-text text-transparent">
          esencial<span class="text-blue">360</span>
        </h3>
      </div>
      <button 
        (click)="toggle()" 
        class="group p-3 rounded-xl hover:bg-gradient-to-r hover:from-blue/10 hover:to-strongBrown/10 transition-all duration-300"
      >
        <span class="material-symbols-outlined text-blue text-3xl group-hover:scale-110 transition-transform duration-300">menu</span>
      </button>
    </div>
  </header>

  } @else {

  <!-- Enhanced Non-Authenticated Header -->
  <header
    [class]="getNonAuthenticatedHeaderClasses()"
    [style]="getHeaderBoxShadow()"
    class="relative overflow-hidden"
  >
    <!-- Background decorative elements -->
    <div class="absolute top-0 right-0 w-64 h-16 bg-gradient-to-l from-blue/5 to-transparent"></div>
    <div class="absolute top-0 left-0 w-48 h-16 bg-gradient-to-r from-strongBrown/5 to-transparent"></div>
    
    <!-- Desktop Header -->
    <div class="hidden xl:flex justify-between items-center px-20 h-20 relative z-10">
      <!-- Enhanced Logo -->
      <div
        class="flex items-center gap-4 cursor-pointer select-none group"
        (click)="onHome()"
      >
        <div class="relative">
          <img
            [src]="getLogoSource()"
            alt="Logo"
            class="h-16 w-auto rounded-2xl shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105 drop-shadow-md"
          />
          <!-- Enhanced glow effect -->
          <div class="absolute inset-0 bg-blue/20 rounded-2xl opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-300 -z-10"></div>
        </div>
        <h3
          [class]="getLogoTextClass()"
          class="text-2xl tracking-tight bg-gradient-to-r from-veige via-strongBrown to-blue bg-clip-text text-transparent group-hover:scale-105 transition-transform duration-300"
        >
          esencial<span class="text-blue">360</span>
        </h3>
      </div>

      <!-- Enhanced Navigation -->
      <nav>
        <ul class="flex items-center space-x-8 font-medium uppercase text-sm tracking-wide">
          <li>
            <a
              (click)="onInstructors()"
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Instructores
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          @if (newLanding) {
          <li>
            <a 
              (click)="onCounsel()" 
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Consejo
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          }
          <li>
            <a 
              (click)="onClasses()" 
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Clases
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          @if (newLanding) {
          <li>
            <a
              (click)="onMeditations()"
              class="relative group hover:text-blue transition-all duration-300 cursor-pointer"
            >
              Meditaciones
              <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
            </a>
          </li>
          }

          <!-- Enhanced Login -->
          <li
            (click)="authService.loginWithRedirect()"
            class="relative group cursor-pointer hover:text-blue transition-all duration-300"
          >
            Inicia SesiÃ³n
            <div class="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue to-strongBrown group-hover:w-full transition-all duration-300"></div>
          </li>

          <!-- Enhanced Subscribe Button -->
          <button
            (click)="onStartProcess()"
            class="group relative overflow-hidden flex items-center rounded-full bg-gradient-to-r from-lightBrown to-strongBrown px-6 py-3 text-white text-sm font-semibold uppercase shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
          >
            <!-- Button background effect -->
            <div class="absolute inset-0 bg-gradient-to-r from-strongBrown to-blue opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full"></div>
            
            <span class="relative">SuscrÃ­bete</span>
            <svg
              class="relative w-4 h-4 ml-2 text-white group-hover:translate-x-1 transition-transform duration-300"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
            
            <!-- Shine effect -->
            <div class="absolute inset-0 -translate-x-full group-hover:translate-x-full bg-gradient-to-r from-transparent via-white/20 to-transparent transition-transform duration-700 ease-out rounded-full"></div>
          </button>
        </ul>
      </nav>
    </div>

    <!-- Enhanced Mobile Header -->
    <div class="xl:hidden flex justify-between items-center px-4 h-16 relative z-10">
      <div class="flex items-center gap-3 cursor-pointer group" (click)="onHome()">
        <img
          [src]="pullZone + '/assets/blueLogo.png'"
          alt="Logo"
          class="h-12 w-auto rounded-xl shadow-md group-hover:shadow-lg transition-shadow duration-300"
        />
        <h3 class="font-bold text-lg bg-gradient-to-r from-veige to-strongBrown bg-clip-text text-transparent">
          esencial<span class="text-blue">360</span>
        </h3>
      </div>
      <button 
        (click)="toggle()" 
        class="group p-3 rounded-xl hover:bg-gradient-to-r hover:from-blue/10 hover:to-strongBrown/10 transition-all duration-300"
      >
        <span 
          [class]="getMobileMenuIconClass()" 
          class="text-blue text-3xl group-hover:scale-110 transition-transform duration-300"
        >
          menu
        </span>
      </button>
    </div>
  </header>
  }
</div>

<!-- Enhanced Mobile Menu Overlay -->
<section
  class="xl:hidden fixed top-0 left-0 w-full h-full montserrat-normal bg-gradient-to-br from-white via-gray-50/80 to-white backdrop-blur-md text-strongBrown z-[60] overflow-hidden"
  [@menuAnimation]="isOpen ? 'open' : 'closed'"
>
  <!-- Background decorative elements -->
  <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-bl from-blue/10 to-transparent rounded-full -translate-y-32 translate-x-32"></div>
  <div class="absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-strongBrown/10 to-transparent rounded-full translate-y-24 -translate-x-24"></div>
  
  <!-- Enhanced Close Button -->
  <button
    class="xl:hidden absolute top-5 right-6 p-3 rounded-xl hover:bg-gradient-to-r hover:from-red-500/10 hover:to-red-600/10 group transition-all duration-300 z-20"
    (click)="toggle()"
  >
    <span class="material-symbols-outlined text-blue text-3xl group-hover:rotate-90 group-hover:text-red-500 transition-all duration-300">close</span>
  </button>

  <!-- Enhanced Mobile Logo -->
  <div
    class="flex items-center gap-3 px-4 mt-6 cursor-pointer group relative z-10"
    (click)="onHome()"
  >
    <img
      [src]="pullZone + '/assets/blueLogo.png'"
      alt="Logo"
      class="h-12 w-auto rounded-xl shadow-md group-hover:shadow-lg transition-shadow duration-300"
    />
    <h3 class="font-bold text-lg bg-gradient-to-r from-veige to-strongBrown bg-clip-text text-transparent">
      esencial<span class="text-blue">360</span>
    </h3>
  </div>

  <!-- Enhanced Mobile Navigation -->
  <div class="container mx-auto px-4 mt-12 relative z-10">
    @if(authService.isAuthenticated$ | async) {
    <ul class="space-y-6 text-lg font-semibold">
      @if (roles === "User") {
      <!-- Enhanced streak display -->
      <div class="flex items-center mb-6 p-4 bg-gradient-to-r from-orange-50 to-red-50 rounded-2xl border border-orange-200">
        <div class="relative mr-4">
          <span class="text-2xl animate-pulse">ðŸ”¥</span>
          <div class="absolute -inset-1 bg-orange rounded-full blur animate-pulse"></div>
        </div>
        <div>
          <span class="font-bold text-2xl bg-gradient-to-r from-orange to-red bg-clip-text text-transparent">{{ streak }}</span>
          <div class="text-sm text-gray-600">dÃ­as consecutivos</div>
        </div>
      </div>
      }

      <!-- Enhanced menu items -->
      <li
        (click)="onClasses(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Clases
        </div>
      </li>
      <li
        (click)="onMeditations(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Meditaciones
        </div>
      </li>
      <li
        (click)="onInstructors(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Instructores
        </div>
      </li>
      @if (roles === "User") {
      <li
        (click)="onCounsel(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Consejo
        </div>
      </li>
      }

      <!-- Enhanced divider -->
      <li class="border-t border-gradient-to-r from-gray-200 via-blue/30 to-gray-200 pt-6 my-8"></li>

      @if (roles === "User") {
      <li
        (click)="onUserSettings(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-strongBrown rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Mi Perfil
        </div>
      </li>
      }
      <li 
        (click)="signOut(); toggle()" 
        class="group cursor-pointer hover:text-red-500 transition-all duration-300 p-2 rounded-lg hover:bg-red-50"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-red-500 rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Logout
        </div>
      </li>
      <li
        (click)="onContact(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-green-500 rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          ContÃ¡ctanos
        </div>
      </li>
    </ul>
    } @else {
    <ul class="space-y-6 text-lg font-semibold">
      <li
        (click)="onClasses(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Clases
        </div>
      </li>
      <li
        (click)="onMeditations(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Meditaciones
        </div>
      </li>
      <li
        (click)="onInstructors(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Instructores
        </div>
      </li>
      <li
        (click)="onCounsel(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Consejo
        </div>
      </li>

      <li class="border-t border-gradient-to-r from-gray-200 via-blue/30 to-gray-200 pt-6 my-8"></li>

      <li
        (click)="authService.loginWithRedirect(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-green-500 rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          Inicia SesiÃ³n
        </div>
      </li>
      <li
        (click)="onStartProcess(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-strongBrown rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          SuscrÃ­bete
        </div>
      </li>
      <li
        (click)="onContact(); toggle()"
        class="group cursor-pointer hover:text-blue transition-all duration-300 p-2 rounded-lg hover:bg-blue/5"
      >
        <div class="flex items-center">
          <div class="w-2 h-2 bg-blue rounded-full mr-3 group-hover:scale-150 transition-transform duration-300"></div>
          ContÃ¡ctanos
        </div>
      </li>
    </ul>
    }
  </div>
</section>
<app-dialog-popup
  (close)="onCloseSteps()"
  (confirmed)="onConfirmedSteps()"
  [isOpen]="isStepsOpen"
>
</app-dialog-popup>
