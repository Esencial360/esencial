<div
  class="top-0 z-[60] w-full"
  [ngClass]="newLanding ? 'absolute' : 'relative'"
>
  @if(authService.isAuthenticated$ | async) {

  <!-- Authenticated Header -->
  <header
    [class]="getAuthenticatedHeaderClasses()"
    [style]="getHeaderBoxShadow()"
  >
    <!-- Desktop Header -->
    <div class="hidden xl:flex justify-between items-center px-20 h-20">
      <!-- Logo -->
      <div class="flex items-center gap-2 cursor-pointer" (click)="onHome()">
        <img
          [src]="pullZone + '/assets/blueLogo.png'"
          alt="Logo"
          class="h-12 w-auto rounded-lg"
        />
        <h3 class="font-bold text-xl tracking-tight text-veige">
          esencial<span class="text-blue">360</span>
        </h3>
      </div>

      <!-- Navigation -->
      <nav>
        <ul
          class="flex items-center space-x-8 font-medium uppercase text-sm tracking-wide"
        >
          @if (roles === "User") {
          <!-- Streak -->
          <div class="flex items-center pr-6 border-r border-gray-300/50">
            <span class="text-xl">游댠</span>
            <span class="ml-2 font-semibold text-lg">{{ streak }}</span>
          </div>

          <!-- Links -->
          <li>
            <a
              (click)="onInstructors()"
              class="hover:text-blue transition-colors"
              >Instructores</a
            >
          </li>
          <li>
            <a (click)="onClasses()" class="hover:text-blue transition-colors"
              >Clases</a
            >
          </li>
          <li>
            <a
              (click)="onMeditations()"
              class="hover:text-blue transition-colors"
              >Meditaciones</a
            >
          </li>
          @if (newLanding) {
          <li>
            <a (click)="onCounsel()" class="hover:text-blue transition-colors"
              >Consejo</a
            >
          </li>
          } }

          <!-- Logout -->
          <li
            (click)="signOut()"
            class="cursor-pointer hover:text-blue transition-colors"
          >
            Logout
          </li>

          <!-- Profile -->
          @if (roles === "User") {
          <button
            (click)="onUserSettings()"
            class="flex items-center rounded-full bg-lightBrown px-5 py-2 text-white text-sm font-semibold uppercase shadow hover:bg-strongBrown transition"
          >
            <span>Mi perfil</span>
            <svg
              class="w-4 h-4 ml-2 text-white"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </button>
          }
        </ul>
      </nav>
    </div>

    <!-- Mobile Header -->
    <div class="xl:hidden flex justify-between items-center px-4 h-16">
      <div class="flex items-center gap-2 cursor-pointer" (click)="onHome()">
        <img
          [src]="pullZone + '/assets/blueLogo.png'"
          alt="Logo"
          class="h-10 w-auto rounded-lg"
        />
        <h3 class="font-bold text-lg text-veige">
          esencial<span class="text-blue">360</span>
        </h3>
      </div>
      <button (click)="toggle()" class="p-2 rounded-md hover:bg-gray-200/30">
        <span class="material-symbols-outlined text-blue text-3xl">menu</span>
      </button>
    </div>
  </header>

  } @else {

  <!-- Non-Authenticated Header -->
  <header
    [class]="getNonAuthenticatedHeaderClasses()"
    [style]="getHeaderBoxShadow()"
  >
    <!-- Desktop Header -->
    <div class="hidden xl:flex justify-between items-center px-20 h-20">
      <!-- Logo -->
      <div
        class="flex items-center gap-3 cursor-pointer select-none"
        (click)="onHome()"
      >
        <img
          [src]="getLogoSource()"
          alt="Logo"
          class="h-14 w-auto rounded-xl drop-shadow-md"
        />
        <h3
          [class]="getLogoTextClass()"
          class="text-2xl tracking-tight text-veige"
        >
          esencial<span class="text-blue">360</span>
        </h3>
      </div>

      <!-- Navigation -->
      <nav>
        <ul
          class="flex items-center space-x-8 font-medium uppercase text-sm tracking-wide"
        >
          <li>
            <a
              (click)="onInstructors()"
              class="hover:text-blue transition-colors"
              >Instructores</a
            >
          </li>
          @if (newLanding) {
          <li>
            <a (click)="onCounsel()" class="hover:text-blue transition-colors"
              >Consejo</a
            >
          </li>
          }
          <li>
            <a (click)="onClasses()" class="hover:text-blue transition-colors"
              >Clases</a
            >
          </li>
          @if (newLanding) {
          <li>
            <a
              (click)="onMeditations()"
              class="hover:text-blue transition-colors"
              >Meditaciones</a
            >
          </li>
          }

          <!-- Login -->
          <li
            (click)="authService.loginWithRedirect()"
            class="cursor-pointer hover:text-blue transition-colors"
          >
            Inicia Sesi칩n
          </li>

          <!-- Subscribe -->
          <button
            (click)="onStartProcess()"
            class="flex items-center rounded-full bg-lightBrown px-5 py-2 text-white text-sm font-semibold uppercase shadow hover:bg-strongBrown transition"
          >
            <span>Suscr칤bete</span>
            <svg
              class="w-4 h-4 ml-2 text-white"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </button>
        </ul>
      </nav>
    </div>

    <!-- Mobile Header -->
    <div class="xl:hidden flex justify-between items-center px-4 h-16">
      <div class="flex items-center gap-2 cursor-pointer" (click)="onHome()">
        <img
          [src]="pullZone + '/assets/blueLogo.png'"
          alt="Logo"
          class="h-10 w-auto rounded-lg"
        />
        <h3 class="font-bold text-lg text-veige">
          esencial<span class="text-blue">360</span>
        </h3>
      </div>
      <button (click)="toggle()" class="p-2 rounded-md hover:bg-gray-200/30">
        <span [class]="getMobileMenuIconClass()" class="text-blue text-3xl"
          >menu</span
        >
      </button>
    </div>
  </header>
  }
</div>

<!-- Mobile Menu Overlay -->
<section
  class="xl:hidden fixed top-0 left-0 w-full h-full montserrat-normal bg-white text-strongBrown z-[60]"
  [@menuAnimation]="isOpen ? 'open' : 'closed'"
>
  <button
    class="xl:hidden absolute top-5 right-6 p-2 rounded-md hover:bg-gray-200/30"
    (click)="toggle()"
  >
    <span class="material-symbols-outlined text-blue text-3xl">close</span>
  </button>

  <!-- Mobile Logo -->
  <div
    class="flex items-center gap-2 px-4 mt-6 cursor-pointer"
    (click)="onHome()"
  >
    <img
      [src]="pullZone + '/assets/blueLogo.png'"
      alt="Logo"
      class="h-10 w-auto rounded-lg"
    />
    <h3 class="font-bold text-lg text-veige">
      esencial<span class="text-blue">360</span>
    </h3>
  </div>

  <!-- Mobile Navigation -->
  <div class="container mx-auto px-4 mt-12">
    @if(authService.isAuthenticated$ | async) {
    <ul class="space-y-6 text-lg font-semibold">
      @if (roles === "User") {
      <div class="flex items-center mb-4">
        <span class="text-xl">游댠</span>
        <span class="ml-2 font-semibold text-lg">{{ streak }}</span>
      </div>
      }

      <li
        (click)="onClasses(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Clases
      </li>
      <li
        (click)="onMeditations(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Meditaciones
      </li>
      <li
        (click)="onInstructors(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Instructores
      </li>
      @if (roles === "User") {
      <li
        (click)="onCounsel(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Consejo
      </li>
      }

      <li class="border-t border-gray-200 pt-4 my-6"></li>

      @if (roles === "User") {
      <li
        (click)="onUserSettings(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Mi Perfil
      </li>
      }
      <li (click)="signOut(); toggle()" class="cursor-pointer hover:text-blue">
        Logout
      </li>
      <li
        (click)="onContact(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Cont치ctanos
      </li>
    </ul>
    } @else {
    <ul class="space-y-6 text-lg font-semibold">
      <li
        (click)="onClasses(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Clases
      </li>
      <li
        (click)="onMeditations(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Meditaciones
      </li>
      <li
        (click)="onInstructors(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Instructores
      </li>
      <li
        (click)="onCounsel(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Consejo
      </li>

      <li class="border-t border-gray-200 pt-4 my-6"></li>

      <li
        (click)="authService.loginWithRedirect(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Inicia Sesi칩n
      </li>
      <li
        (click)="onStartProcess(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Suscr칤bete
      </li>
      <li
        (click)="onContact(); toggle()"
        class="cursor-pointer hover:text-blue"
      >
        Cont치ctanos
      </li>
    </ul>
    }
  </div>
</section>

<app-dialog-popup
  (close)="onCloseSteps()"
  (confirmed)="onConfirmedSteps()"
  [isOpen]="isStepsOpen"
>
</app-dialog-popup>
